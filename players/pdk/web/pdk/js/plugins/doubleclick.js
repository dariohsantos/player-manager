$pdk.ns("$pdk.plugin.doubleclick.version");$pdk.plugin.doubleclick.version="2.0.13-08-23_01_31";$pdk.ns("$pdk.plugin.doubleclick");$pdk.plugin.doubleclick.Doubleclick=$pdk.extend(function(){},{VERSION:"3.0",AD_CONTAINER_ID_PREFIX:"tpAdContainer",_callback:"tpDCLoaded",_dcUrl:null,_imaJavaScriptUrl:"http://s0.2mdn.net/instream/html5/ima3.js",_adDisplayContainer:null,_adDisplayContainerInitialized:false,_adsLoader:null,_hosts:null,_mimeTypes:null,_imaSDKLoaded:false,_bitrate:0,_overlayArea:{width:0,height:0},_mediaArea:{width:0,height:0},_currentAdClipUrl:null,_currentAdClip:null,_adContainer:null,_isFullScreen:false,_pdkReadyManager:null,_adRuleGovernor:null,_contentPlaybackTimeManager:null,_pdkAdsManager:null,_adStateContext:null,_adErrorListener:null,constructor:function(){this._adContainer=document.createElement("div")},initialize:function(a){var b=this;this._lo=a;this._controller=this._lo.controller;this._controller.registerAdPlugIn(this);this._hosts=this.extractLoadVars([a.vars.host,a.vars.hosts],["ad.doubleclick.net"]);this.log("\thosts: "+this._hosts?this._hosts:"no host or hosts loadvar applied.");this._mimeTypes=this.extractLoadVars([a.vars.mimeType,a.vars.mimeTypes],null);this.log("\tmimeTypes: "+this._mimeTypes?this._mimeTypes:"no mimeType or mimeTypes loadvar applied.");this._adContainer.id=this.AD_CONTAINER_ID_PREFIX+this._controller.id;this._contentPlaybackTimeManager=new $pdk.plugin.doubleclick.ContentPlaybackTimeManager(this._controller);this._pdkReadyManager=new $pdk.plugin.doubleclick.PdkReadyManager(this._contentPlaybackTimeManager);this._adStateContext=new $pdk.plugin.doubleclick.AdStateContext(this._controller);this._adRuleGovernor=new $pdk.plugin.doubleclick.AdRuleGovernor(this._contentPlaybackTimeManager,this);this._controller.addEventListener("OnReleaseStart",function(){b._onReleaseStart.apply(b,arguments)});this._controller.addEventListener("OnReleaseEnd",function(){b._onReleaseEnd.apply(b,arguments)});this._controller.addEventListener("OnStreamSwitched",function(){b._onStreamSwitched.apply(b,arguments)});this._controller.addEventListener("OnMediaEnd",function(){b._onMediaEnd.apply(b,arguments)});this._controller.addEventListener("OnMediaLoadStart",function(){b._onMediaLoadStart.apply(b,arguments)});if(!this.checkIMAExists()){tpLoadScript(this._imaJavaScriptUrl,function(c){b.onIMASDKLoaded()})}else{this.log("\tGIMA Version: "+google.ima.VERSION+" exists in DOM skipping loading!!!");this.initializeSDK()}},extractLoadVars:function(d,b){var c=[];this.log(".extractLoadVars: "+d);for(var f=d.length-1;f>=0;f--){var e=d[f];this.log("\tv: "+e);if(!e){continue}if(e.indexOf(",")>-1){this.log(e.split(","));c=c.concat(e.split(","))}else{c.push(e)}}if(c.length==0){return b}return c},checkIMAExists:function(){return !(typeof google=="undefined"||typeof google.ima=="undefined")},_onOverlayAreaChanged:function(a){this._overlayArea.width=a.data.width;this._overlayArea.height=a.data.height},_onMediaAreaChanged:function(a){this._mediaArea.width=a.data.width;this._mediaArea.height=a.data.height;this._doAdResize()},_doAdResize:function(){var c=this.isCurrentStateLinear();if(this._pdkAdsManager&&c!=null){var a=0;var b=0;if(c){this.log("._doAdResize: setting area to media area");a=this._mediaArea.width;b=this._mediaArea.height}else{this.log("._doAdResize: setting area to overlay area");a=this._overlayArea.width;b=this._overlayArea.height}this._pdkAdsManager.getAdsManager().resize(a,b,(this._isFullScreen)?google.ima.ViewMode.FULLSCREEN:google.ima.ViewMode.NORMAL)}},_onShowFullScreen:function(a){this._isFullScreen=a.data;if(this._adStateContext){this._adStateContext.setFullScreen(this._isFullScreen)}},_onUserInitiatedPlayback:function(a){this.log("._onUserInitiatedPlayback: creating ad display container and initializing.");this._createAdDisplayContainer();this._adDisplayContainer.initialize()},onIMASDKLoaded:function(){this.log(".onIMASDKLoaded: google.ima loaded; version["+google.ima.VERSION+"]",tpConsts.INFO);this.initializeSDK()},initializeSDK:function(){this._imaSDKLoaded=true;var a=document.getElementById(this._controller.id+".plugins");a.appendChild(this._adContainer);this._updateAreas();var b=this;this._controller.addEventListener("OnOverlayAreaChanged",function(){b._onOverlayAreaChanged.apply(b,arguments)});this._controller.addEventListener("OnMediaAreaChanged",function(){b._onMediaAreaChanged.apply(b,arguments)});this._controller.addEventListener("OnShowFullScreen",function(){b._onShowFullScreen.apply(b,arguments)});this._controller.addEventListener("OnPlayButtonClicked",function(){b._onUserInitiatedPlayback.apply(b,arguments)});this._controller.addEventListener("OnSetRelease",function(){b._onUserInitiatedPlayback.apply(b,arguments)});if(this._currentAdClip){this.log("\tcalling _doIsHandled from ima sdk load complete.");this._doIsHandled()}},_updateAreas:function(){var b=this._controller.getOverlayArea();this._overlayArea.width=b.width;this._overlayArea.height=b.height;var a=this._controller.getMediaArea();this._mediaArea.width=a.width;this._mediaArea.height=a.height},_onReleaseStart:function(g){this.log("._onReleaseStart");this.reset(false);var h=g.data;var j=[];var a=h.clips;var f=a.length;for(var b=0;b<f;b++){var d=a[b];if(d.baseClip.isAd){j.push(this._contentPlaybackTimeManager.getAggregateTime(d,h))}}this._adRuleGovernor.setPlaylistAdBreaks(j);this._contentPlaybackTimeManager.releaseStart(h);var c=this._getFirstNonAdClip(h);if(c){this._updateBitrate(c)}},_onReleaseEnd:function(a){this.log(".onReleaseEnd");this._contentPlaybackTimeManager.releaseEnd();this.reset(false)},_isNewAdClipURL:function(a){if(this._currentAdClipUrl!=a){this._currentAdClipUrl=a;return true}return false},_createAdDisplayContainer:function(){this.log("._createAdDisplayContainer");if(!this._adDisplayContainer){if(this.useCustomPlayback()){this.log("\tusing custom playback");this._adDisplayContainer=new google.ima.AdDisplayContainer(this._adContainer,this._controller.getVideoProxy())}else{this.log("\tusing standard playback");this._adDisplayContainer=new google.ima.AdDisplayContainer(this._adContainer)}}},useCustomPlayback:function(){if(navigator.userAgent.match(/iPad/i)){return true}if(navigator.userAgent.match(/iPhone/i)){return true}else{if(!navigator.userAgent.match(/Android/i)){return false}else{if(navigator.userAgent.toLowerCase().indexOf("android")!=-1){return true}else{return false}}}},_supportsAdRules:function(){if(tpIsIOS()){var a=(navigator.appVersion).match(/OS (\d+)_(\d+)_?(\d+)?/);if(navigator.userAgent.match(/iPad/i)&&parseInt(a[1])>=5){return true}else{return false}}if(tpIsAndroid()){return false}if(navigator.userAgent.toLowerCase().match(/safari/i)){return true}if(navigator.userAgent.toLowerCase().match(/chrome/i)){return true}if(navigator.userAgent.toLowerCase().match(/firefox/i)){return true}return false},_initAdLoader:function(c){this.log("._initAdLoader");if(!this._imaSDKLoaded){this.log("\tima sdk not loaded yet.");return}this._disposeAllAdObjects();this._adStates=new $pdk.plugin.doubleclick.AdStates(this._adStateContext,this._adRuleGovernor,this,this._controller);this._pdkReadyManager.setPdkReadyCallbackInstance(this._adStates);this._createAdDisplayContainer();if(!this._adsLoader){this.log("\tnew AdsLoader");this._adsLoader=new google.ima.AdsLoader(this._adDisplayContainer);var b=this;this._adsLoader.addEventListener(google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,function(){b._onAdsManagerLoaded.apply(b,arguments)},false);this._adsLoader.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,function(){b._adsLoadErrorHandler.apply(b,arguments)},false)}var a=c?c:this._currentAdClipUrl;if(a.match(/ad_rule=1/g)){this.log("\tWe are an ad rule. Doing check to see if rules are supported.");if(!this._supportsAdRules()){this.log("\tre writing ad rule to ad tag");a=this._rewriteAdRuleUrlToTag(a)}}this.log("\trequest url: "+a);this._adsLoader.requestAds(this._generateAdsRequest(a))},_rewriteAdRuleUrlToTag:function(a){if(a.match(/ad_rule=1/g)){return a.replace(/ad_rule=1/,"ad_rule=0")}},_generateAdsRequest:function(b){var a={adTagUrl:b,linearAdSlotWidth:this._mediaArea.width,linearAdSlotHeight:this._mediaArea.height,nonLinearAdSlotWidth:this._overlayArea.width,nonLinearAdSlotHeight:this._overlayArea.height};return a},_getFirstAdClip:function(c){for(var a=0;a<c.clips.length;a++){var b=c.clips[a];if(b.baseClip.isAd){return b}}return null},_getFirstNonAdClip:function(c){for(var a=0;a<c.clips.length;a++){var b=c.clips[a];if(!b.baseClip.isAd&&b.baseClip&&b.baseClip.bitrate){return b}}return null},_onAdsManagerLoaded:function(h){this.log("._onAdsManagerLoaded");var d={};d.bitrate=this._bitrate;if(this._mimeTypes&&this._mimeTypes.length>0){d.mimeTypes=this._mimeTypes}var g={currentTime:0,duration:0,videoProxy:this._controller.getVideoProxy()};this._contentPlaybackTimeManager.setPlaybackObject(g);var c=h.getAdsManager(g,d);if(c){this._pdkAdsManager=new $pdk.plugin.doubleclick.PdkAdsManager(c,this._controller,this._adContainer);this.log("\tnew pdkAdsManager");var b=c.getCuePoints();this.log("\tcuePoints: "+(b.length==0?"none (ad tag)":b.join(", ")));this._pdkAdsManager.getAdsManager().addEventListener(google.ima.AdEvent.Type.ALL_ADS_COMPLETED,this._allAdsCompletedHandler,false,this);this._pdkAdsManager.getAdsManager().addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,this._adErrorHandler,false,this);if(b&&b.length>0&&b[0]==-1){var f=this;this._pdkAdsManager.getAdsManager().addEventListener(google.ima.AdEvent.Type.CONTENT_RESUME_REQUESTED,function a(){f._contentComplete()},false)}this._adRuleGovernor.setCuePoints(b);this._adStates.setAdsManager(this._pdkAdsManager);this._updateAreas();try{this.log("\tbitrate on init: "+this._bitrate);this._pdkAdsManager.init(this._mediaArea.width,this._mediaArea.height,this._bitrate,this._isFullScreen)}catch(h){this.log("\tError on AdsManager.init: "+h.message)}}else{this.log("\tError: AdsManager is null!")}},isAd:function(a){return this.checkIsHandled(a.streamType,a.mediaLength,a.baseClip.URL,a.baseClip.type)},checkAd:function(b){var a=this.checkIsHandled(b.streamType,b.mediaLength,b.baseClip.URL,b.baseClip.type);this.log(".checkAd: isHandled: "+a);if(a){this.log("\tchecking for existing state to clear.");if(this._adStates&&this._adStates.clearExistingState()){this.log("\tHave an active ad at content clip end. Clearing it out.");this.reset(false)}this._currentAdClip=b;this._adStateContext.setCurrentClip(b);if(this._imaSDKLoaded){this._doIsHandled()}}return a},_doIsHandled:function(){this.log("._doIsHandled");if(this._isNewAdClipURL(this._currentAdClip.baseClip.URL)){this.log("\thandling new ad clip url");this._initAdLoader(null)}this._adRuleGovernor.setCurrentClip(this._currentAdClip)},_handleCheckAdForClip:function(b){this.log(".handleCheckAdForClip");var c=this._contentPlaybackTimeManager.getAggregateTime(b,this._adStateContext.getReleasePlaylist());if(!this._adRuleGovernor.isValidAdTime(c)){this.log("\tnot a valid ad time: "+c);this.log("\tcalling controller.setAds(null)");this._controller.setAds(null);return}var a=this._adRuleGovernor.getCuePoint(c);this.log("\tcuePointTime, aggregateTime: "+a+", "+c);if(!isNaN(a)){this.log("\tsending in time to trigger ad loading: aggregateTime, cuePointTime: "+c+", "+a);this._contentPlaybackTimeManager.setContentPlayheadTime(a)}if(this._adStates){this._adStates.checkAd()}this._pdkReadyManager.setCheckAd(true);if(c==$pdk.plugin.doubleclick.POST_ROLL_TIME){this._contentComplete()}},_contentComplete:function(){var a="._contentComplete";if(this._adsLoader){a+=": called it on adsloader";this._adsLoader.contentComplete()}else{a+=": no adslaoder"}this.log(a)},_updateBitrate:function(a){if(!a.baseClip.isAd){this._bitrate=a.baseClip.bitrate/1024;this.log("._updateBitrate: "+this._bitrate)}},checkIsHandled:function(a,d,b,c){this.warn(".checkIsHandled streamType = "+a);this.log(".checkIsHandled streamType = "+a);if($pdk.isIE){this.log("\tBrowser is IE based DoubleClick does not support IE");return false}this.log("\tnot IE");if(a=="empty"){return false}if(!this.isDoubleClickUrl(b)&&!this.isDoubleClickType(c)){return false}return true},isDoubleClickUrl:function(a){if(!a||!this._hosts||this._hosts.length===0){return false}var b=this.getHostname(a);for(var c=0;c<this._hosts.length;c++){if(b.match(this._hosts[c])){return true}}return false},getHostname:function(c){var b=document.createElement("a");b.href=c;return b.hostname},isDoubleClickType:function(a){if(!a||!this._mimeTypes||this._mimeTypes.length===0){return false}for(var b=0;b<this._mimeTypes.length;b++){if(a.match(this._mimeTypes[b])){return true}}return false},isCurrentStateLinear:function(){if(!this._adStates||!this._adStates.getCurrentState()){return null}return this._adStates.getCurrentState().getLinear()},_onStreamSwitched:function(a){this._bitrate=a.bitrate/1024},_onMediaEnd:function(b){this.log("._onMediaEnd");var a=b.data;if(!a.baseClip.isAd){this._pdkReadyManager.setContentMediaEnd(true)}},_onMediaLoadStart:function(b){var a=b.data;this.log("._onMediaLoadStart isAd: "+a.baseClip.isAd);if(a.baseClip.isAd){this._pdkReadyManager.setContentMediaEnd(true)}},_allAdsCompletedHandler:function(a){this.log("._allAdsCompletedHandler");this._contentComplete();this.reset(false)},reset:function(b){this.log(".reset");this._disposeAllAdObjects();this._adStateContext.reset();this._adRuleGovernor.reset();var a=this._currentAdClipUrl;this._currentAdClipUrl=null;if(b){this._initAdLoader(a)}},_disposeAllAdObjects:function(){if(this._adsLoader!=null){if(this._adStates){this._adStates.dispose()}this._adStates=null}},_adErrorHandler:function(a){this.log("AdsManager > AdErrorEvent.Type.AD_ERROR: Error during ad playback, so end this ad break.",tpConsts.WARN);this._currentAdClip.hasPlayed=true;this._controller.endMedia(this._currentAdClip);this.reset(false);this._adsLoader.destroy();this._adsLoader=null;if(a){tpDebug("Doubleclick: AdsManager > AdErrorEvent.Type.AD_ERROR: Error during ad playback, so end this ad break.",this._controller.id,"Doubleclick",tpConsts.WARN)}},_inspect:function(b){var c="|||";for(var a in b){if(b.hasOwnProperty(a)){c+=a+" = "+b[a]+">>"}}this.log(c)},_adsLoadErrorHandler:function(a){this.log("AdsLoader > AdErrorEvent.Type.AD_ERROR: Error trying to load ads. Bypass ad break.");this._controller.setAds(null);this.reset(false);this._adsLoader.destroy();this._adsLoader=null;if(this._adDisplayContainer){this.log("\tdestroy ad display container");this._adDisplayContainer.destroy();this._adDisplayContainer=null}if(a){tpDebug("Doubleclick: AdsLoader > AdErrorEvent.Type.AD_ERROR: Error trying to load ads. Bypass ad break.",this._controller.id,"Doubleclick",tpConsts.WARN)}},log:function(a,b){if(!b){b=tpConsts.DEBUG}tpDebug(a,this._controller.id,"Doubleclick",b)},warn:function(a){tpDebug(a,this._controller.id,"Doubleclick",tpConsts.WARN)}});$pdk.plugin.doubleclick.PdkReadyManager=$pdk.extend(function(){},{_pdkReadyCallbackInstance:null,_getContentPlaybackTime:null,constructor:function(a){this._contentPlaybackTimeManager=a},checkPdkReady:function(){this.log(".checkPdkReady");var a=false;if(this._checkAd&&this._mediaEnd){a=true}else{if(this._checkAd&&this._contentPlaybackTimeManager.getContentPlayheadTime()<1){a=true}}if(a){this.log("\tcalling playAds.");this._pdkReadyCallbackInstance.playAds();this._reset()}else{this.log("\tpdk not ready.")}},setPdkReadyCallbackInstance:function(a){this._pdkReadyCallbackInstance=a},getCheckAd:function(){return this._checkAd},setCheckAd:function(a){this.log(".setCheckAd");this._checkAd=a;this.checkPdkReady()},getNonAdMediaEnd:function(){return this._mediaEnd},setContentMediaEnd:function(a){this.log(".setContentMediaEnd");if(!this._checkAd){this.log("\tno checkAd yet OR preroll and reset already called.");return}this._mediaEnd=a;this.checkPdkReady()},_reset:function(){this.log("._reset");this._checkAd=false;this._mediaEnd=false},log:function(b,c){if(!c){c=tpConsts.DEBUG}var a="";tpDebug(b,a,"Doubleclick",c)}});$pdk.plugin.doubleclick.POST_ROLL_TIME=Number.POSITIVE_INFINITY;$pdk.plugin.doubleclick.AdRuleGovernor=$pdk.extend(function(){},{AD_SLOT_BUFFER:5000,_adSlots:null,_cuePoints:null,_playlistAdBreaks:null,_currentClip:null,_contentPlaybackTimeManager:null,_doubleclick:null,constructor:function(b,a){this._contentPlaybackTimeManager=b;this._doubleclick=a},setPlaylistAdBreaks:function(a){this._playlistAdBreaks=a.concat();this.log("adBreaks: "+this._playlistAdBreaks.join(", "));this.syncReady()},setCuePoints:function(b){this._cuePoints=[];for(var c=0;c<b.length;c++){var a=b[c]*1000;if(a<0){a=$pdk.plugin.doubleclick.POST_ROLL_TIME}this._cuePoints.push(a)}this.log("cuePoints: "+this._cuePoints.join(", "));this.syncReady()},getCuePointForLoadingState:function(){var d=this._contentPlaybackTimeManager.getContentPlayheadTime();for(var b=0;b<this._adSlots.length;b++){var c=this._adSlots[b];var a=c.adBreak;if(isNaN(a)){continue}if(a>=d-this.AD_SLOT_BUFFER&&a<=d+this.AD_SLOT_BUFFER){return c.cuePoint}}return NaN},syncReady:function(){if(!this._adSlots&&this._cuePoints&&this._playlistAdBreaks){this._adSlots=this._generateAdSlots(this._playlistAdBreaks,this._cuePoints)}if(this._adSlots&&this._currentClip){this.log("\twe have ad slots ("+this._adSlots.length+") and a currentClip");this._doubleclick._handleCheckAdForClip(this._currentClip)}},setCurrentClip:function(a){this._currentClip=a;this.syncReady()},reset:function(){this._cuePoints=null;this._currentClip=null;this._adSlots=null},_generateAdSlots:function(d,g){if(!g||g.length==0){return[]}var h=[];var l=0;var j=0;var a;var b;var k=g.length;var i=d.length;var f=d?i:0;f+=k;var e=0;var c=true;while(c){a=k>l?g[l]:NaN;b=i>j?d[j]:NaN;if(a>=b-this.AD_SLOT_BUFFER&&a<=b+this.AD_SLOT_BUFFER){this.log("\tadding synced adSlot cuePoint: "+a+" adBreak: "+b,tpConsts.INFO);h.push(this._createAdSlot(a,b));l++;j++}else{if(isNaN(b)||a<b){this.log("\tadding unmatched cue point adSlot: cuePoint:"+a+" adBreak:NaN",tpConsts.INFO);h.push(this._createAdSlot(a,NaN));l++}else{this.log("\tadding unmatched chapter point adSlot: cuePoint:NaN adBreak:"+b,tpConsts.INFO);h.push(this._createAdSlot(NaN,b));j++}}c=!(k==l&&i==j);e++;if(e==f){this.log("\tWarning! Something is amiss with ad slot creation. We hit maxLoops.",tpConsts.WARN);c=false}}return h},_createAdSlot:function(a,b){return{cuePoint:a,adBreak:b}},isValidCuePoint:function(a){var b=this._getAdSlotCuePoint(a);if(b){return this._isValidAdSlot(b)}return false},isValidAdTime:function(b){if(this._cuePoints==null||this._cuePoints.length==0){return true}var a=this._getAdSlotFromAdBreak(b);if(a){return this._isValidAdSlot(a)}return false},isValidAdState:function(a){if(isNaN(a.getCuePointTime())){return false}return this.isValidCuePoint(a.getCuePointTime())},getCuePoint:function(b){var a=this._getAdSlotFromAdBreak(b);if(a){return a.cuePoint}return NaN},_isValidAdSlot:function(a){return(!isNaN(a.adBreak)&&!isNaN(a.cuePoint))},_getAdSlotFromAdBreak:function(a){if(!this._adSlots){return null}for(var b=0;b<this._adSlots.length;b++){var c=this._adSlots[b];if(c.adBreak==a){return c}}return null},_getAdSlotCuePoint:function(a){if(!this._adSlots){return null}for(var b=0;b<this._adSlots.length;b++){var c=this._adSlots[b];if(c.cuePoint==a){return c}}return null},log:function(a,b){if(!b){b=tpConsts.DEBUG}tpDebug(a,"","Doubleclick",b)}});$pdk.plugin.doubleclick.PdkAdsManager=$pdk.extend(function(){},{INITIALIZED:"initialized",RUNNING:"running",PAUSED:"paused",_adsManager:null,_controller:null,_currentState:null,_preInitializedState:null,_visible:false,_adContainer:null,constructor:function(b,a,c){this._adsManager=b;this._controller=a;this._adContainer=c},init:function(d,a,c,b){this._adsManager.init(d,a,!b?google.ima.ViewMode.NORMAL:google.ima.ViewMode.FULLSCREEN);this._currentState=this.INITIALIZED;if(this._preInitializedState){this.pause((this._preInitializedState=="true"))}},pause:function(a){this.log(".pause("+a+")");if(!this._currentState){this.log("\tTrying to change state for uninitialized adsManager, so storing state while waiting for init to complete.");this._preInitializedState=a.toString();return}var b="";if(a){if(this._currentState!=this.PAUSED){this._adsManager.pause();b+="\tfinished calling adsManager.pause(); ";this._currentState=this.PAUSED;b+="state -> PdkAdsManagerState.PAUSED"}}else{if(this._currentState==this.INITIALIZED){this._adsManager.start();b+="\tfinished calling adsManager.start(); "}else{if(this._currentState==this.PAUSED){this._adsManager.resume();b+="\tfinished calling adsManager.resume; "}}this._currentState=this.RUNNING;b+="state -> PdkAdsManagerState.RUNNING"}this.log(b)},getCuePoints:function(){return this._adsManager.getCuePoints()},isAdRule:function(){if(!this._adsManager){return false}var a=this._adsManager.getCuePoints();if(a&&a.length>0){return true}return false},setVolume:function(a){this._adsManager.volume=a},setFullScreen:function(b,a){this._adsManager.resize(b,a,google.ima.ViewMode.FULLSCREEN)},setNormalScreen:function(b,a){this._adsManager.resize(b,a,google.ima.ViewMode.NORMAL)},getAdsContainer:function(){return this._adsManager.getAdsContainer()},getAdsManager:function(){return this._adsManager},setVisible:function(a){return;if(a==this._visible){this.log("\tad container is already "+(a?"visible":"not visible"));return}this.log("\tchanging visible from "+(this._visible?"visible":"not visible")+"to "+(a?"visible":"not visible"));this._adContainer.style.visibility=a?"visible":"hidden";this._visible=a},reset:function(){this.log(".reset");try{this._adsManager.destroy()}catch(a){this.log("Internal AdsManager error on AdsManager.destroy(). We got these in Flash too.",tpConsts.INFO)}this._adsManager=null;this._preInitializedState=null;this._currentState=null},log:function(b,c){if(!c){c=tpConsts.DEBUG}var a=this._controller?this._controller.id:"";tpDebug(b,a,"Doubleclick",c)}});$pdk.plugin.doubleclick.ContentPlaybackTimeManager=$pdk.extend(function(){},{_controller:null,_adsManagerPlayheadTime:0,_playbackObject:null,_contentDuration:0,_mediaPlayingListener:null,constructor:function(a){this._controller=a;var b=this;this._mediaPlayingListener=function(){b._onMediaPlaying.apply(b,arguments)}},releaseStart:function(b){this.setContentPlayheadTime(0);this.setContentDuration(this._lastContentClip(b).endTime);var a=this;this._controller.addEventListener("OnMediaPlaying",this._mediaPlayingListener);this._controller.addEventListener("OnMediaStart",function(){a._onMediaStart.apply(a,arguments)});this._controller.addEventListener("OnMediaEnd",function(){a._onMediaEnd.apply(a,arguments)})},releaseEnd:function(){this.setContentPlayheadTime(0);this.setContentDuration(0)},getContentPlayheadTime:function(){return this._adsManagerPlayheadTime},setContentPlayheadTime:function(a){this._adsManagerPlayheadTime=a/1000;if(this._playbackObject){this._playbackObject.currentTime=this._adsManagerPlayheadTime}},setPlaybackObject:function(a){this._playbackObject=a;this._playbackObject.currentTime=this.getContentPlayheadTime();this._playbackObject.duration=this.getContentDuration()},setContentDuration:function(a){this._contentDuration=a;if(this._playbackObject){this._playbackObject.duration=this._contentDuration}},getContentDuration:function(){return this._contentDuration},getAggregateTime:function(e,a){this._controller.removeEventListener("OnMediaPlaying",this._mediaPlayingListener);var j=0;var h=e.clipIndex;var b=a.clips;for(var d=0;d<b.length;d++){var c=b[d];if(c.clipIndex==h){if(h==0){j=0;break}var g=d-1;var f=b[g];while(f){if(!f.baseClip.isAd){break}g--;f=(g>-1)?b[b]:null}if(!f){j=0}else{j=(f.clipIndex==this._lastContentClip(a).clipIndex)?$pdk.plugin.doubleclick.POST_ROLL_TIME:f.endTime}break}}return j},_lastContentClip:function(d){var a=d.clips;var b=a.length;for(b;b>0;b--){var c=a[b-1];if(!c.baseClip.isAd){return c}}return c},_onMediaPlaying:function(b){var a=b.data;if(a){this.setContentPlayheadTime(a.currentTimeAggregate)}},_onMediaStart:function(b){var a=b.data;this.log("._onMediaStart: isAd: "+a.baseClip.isAd);if(!a.baseClip.isAd){this._controller.addEventListener("OnMediaPlaying",this._mediaPlayingListener)}},_onMediaEnd:function(b){var a=b.data;this.log("._onMediaEnd: isAd: "+a.baseClip.isAd)},log:function(b,c){if(!c){c=tpConsts.DEBUG}var a=this._controller?this._controller.id:"";tpDebug(b,a,"Doubleclick",c)}});$pdk.plugin.doubleclick.PdkNoopPlayer=$pdk.extend(function(){},{MEDIA_PLAYING_UPDATE_INTERVAL:250,_controller:null,_volumeSetCallback:null,_muteSetCallback:null,_pauseSetCallback:null,_mediaPlayingCallback:null,_callbackScope:null,_currentReleasePlaylistAdClip:null,_pauseListener:null,_unpauseListener:null,_handleVolumeSetListener:null,_handleMuteSetListener:null,_proxy:null,_playbackInterval:null,constructor:function(c,a,b,e,d,i,j){this._controller=c;this._currentReleasePlaylistAdClip=a;this._volumeSetCallback=b;this._muteSetCallback=e;this._pauseSetCallback=d;this._mediaPlayingCallback=i;this._callbackScope=j;var f=this;this._unpauseListener=function h(){f._handleMediaUnpause.apply(f,arguments)};this._pauseListener=function g(){f._handleMediaPause.apply(f,arguments)};this._handleVolumeSetListener=function h(){f._handleVolumeSet.apply(f,arguments)};this._handleMuteSetListener=function g(){f._handleMuteSet.apply(f,arguments)}},start:function(){this.log(".start");this._controller.dispatchEvent("OnMediaStart",this._currentReleasePlaylistAdClip);this._doPlayback();this._addPlaybackListeners()},pause:function(a){this.log(".pause("+a+")");if(a){clearInterval(this._playbackInterval);this._controller.dispatchEvent("OnMediaPause",this._currentReleasePlaylistAdClip)}else{this._controller.dispatchEvent("OnMediaUnpause",this._currentReleasePlaylistAdClip);this._doPlayback()}},playing:function(a){this._controller.dispatchEvent("OnMediaPlaying",a)},end:function(a){this.log(".end: calling endMedia on generated clip");this._controller.endMedia(this._currentReleasePlaylistAdClip);clearInterval(this._playbackInterval)},done:function(e,d){this.log(".done: calling endMedia on release clip");clearInterval(this._playbackInterval);var a=this._controller;var c=d;setTimeout(function b(){tpDebug("on async, call endMedia.","","Doubleclick",tpConsts.DEBUG);c.mediaLength=e.duration;c.currentMediaTime=e.duration;a.endMedia(c)},10)},_doPlayback:function(){clearInterval(this._playbackInterval);var b=this;this._playbackInterval=setInterval(function a(){b._mediaPlayingCallback.apply(b._callbackScope,arguments)},this.MEDIA_PLAYING_UPDATE_INTERVAL)},_handleVolumeSet:function(a){this._volumeSetCallback.call(this._callbackScope,parseInt(a.data))},_handleMuteSet:function(a){this._muteSetCallback.call(this._callbackScope,a.data)},_handleMediaPause:function(a){if(this._pauseSetCallback){this._pauseSetCallback.call(this._callbackScope,true)}},_handleMediaUnpause:function(a){if(this._pauseSetCallback){this._pauseSetCallback.call(this._callbackScope,false)}},_addPlaybackListeners:function(){this._controller.addEventListener("OnPlayerPause",this._pauseListener);this._controller.addEventListener("OnPlayerUnPause",this._unpauseListener);this._controller.addEventListener("OnVolumeChange",this._handleVolumeSetListener);this._controller.addEventListener("OnMute",this._handleMuteSetListener)},_removePlaybackListeners:function(){this._controller.removeEventListener("OnPlayerPause",this._pauseListener);this._controller.removeEventListener("OnPlayerUnPause",this._unpauseListener);this._controller.removeEventListener("OnVolumeChange",this._handleVolumeSetListener);this._controller.removeEventListener("OnMute",this._handleMuteSetListener)},dispose:function(){this.log(".dispose");this._removePlaybackListeners();clearInterval(this._playbackInterval);this._controller=null;this._volumeSetCallback=null;this._muteSetCallback=null;this._pauseSetCallback=null;this._mediaPlayingCallback=null;this._callbackScope=null;this._currentReleasePlaylistAdClip=null;this._unpauseListener=null;this._pauseListener=null;this._proxy=null;this._playbackInterval=null},log:function(b,c){if(!c){c=tpConsts.DEBUG}var a=this._controller?this._controller.id:"";tpDebug(b,a,"Doubleclick",c)}});$pdk.plugin.doubleclick.AdStateContext=$pdk.extend(function(){},{_controller:null,_releasePlaylist:null,_fullScreen:null,_adsManager:null,_ads:null,_currentClip:null,constructor:function(a){var b=this;this._controller=a;this._controller.addEventListener("OnReleaseStart",function(){b._onReleaseStart.apply(b,arguments)});this._ads=[]},_onReleaseStart:function(a){this._releasePlaylist=a.data},getController:function(){return this._controller},getReleasePlaylist:function(){return this._releasePlaylist},setAdsManager:function(a){this._adsManager=a},getAdsManager:function(){return this._adsManager},setAds:function(a){this._ads=a},getAds:function(){return this._ads},setCurrentClip:function(a){this._currentClip=a},getCurrentClip:function(){return this._currentClip},setFullScreen:function(a){this._fullScreen=a},getFullScreen:function(){return this._fullScreen},reset:function(){this._adsManager=null;this._ads=[];this._currentClip=null}});$pdk.plugin.doubleclick.AdStates=$pdk.extend(function(){},{AD_CONTAINER_ID:"tpAdContainer",_adsManager:null,_stateFactory:null,_adRuleGovernor:null,_adStateContext:null,_checkAd:false,_playAds:false,_unsortedAds:[],_adsAreLinear:0,_state:null,_linearAdsCounter:0,_doubleclick:null,_contentPauseRequestedListener:null,_contentResumeRequestedListener:null,_adCompletedListener:null,_adLoadedListener:null,_adMetadataListener:null,_adStartedListener:null,_adSkippedListener:null,_adPausedListener:null,_adResumedListener:null,_adClickedListener:null,constructor:function(e,c,b,a){this._adStateContext=e;this._adRuleGovernor=c;this._doubleclick=b;this._stateFactory=new $pdk.plugin.doubleclick.StateFactory(a);this._unsortedAds=[];this._playAds=false;this._checkAd=false;this._adsAreLinear=0;this._state=null;this._linearAdsCounter=0;this._controller=a;var d=this;this._contentPauseRequestedListener=function(){d._onContentPauseRequested.apply(d,arguments)};this._contentResumeRequestedListener=function(){d._onContentResumeRequested.apply(d,arguments)};this._adCompletedListener=function(){d._onAdCompleted.apply(d,arguments)};this._adLoadedListener=function(){d._onAdLoaded.apply(d,arguments)};this._adMetadataListener=function(){d._onAdMetadata.apply(d,arguments)};this._adStartedListener=function(){d._onAdStarted.apply(d,arguments)};this._adSkippedListener=function(){d._onAdSkipped.apply(d,arguments)};this._adPausedListener=function(){d._onAdPaused.apply(d,arguments)};this._adResumedListener=function(){d._onAdResumed.apply(d,arguments)};this._adClickedListener=function(){d._onAdClicked.apply(d,arguments)}},_addEventListeners:function(){var a=this._adsManager.getAdsManager();a.addEventListener(google.ima.AdEvent.Type.CONTENT_PAUSE_REQUESTED,this._contentPauseRequestedListener);a.addEventListener(google.ima.AdEvent.Type.CONTENT_RESUME_REQUESTED,this._contentResumeRequestedListener);a.addEventListener(google.ima.AdEvent.Type.LOADED,this._adLoadedListener,false);a.addEventListener(google.ima.AdEvent.Type.AD_METADATA,this._adMetadataListener);a.addEventListener(google.ima.AdEvent.Type.STARTED,this._adStartedListener);a.addEventListener(google.ima.AdEvent.Type.SKIPPED,this._adSkippedListener);a.addEventListener(google.ima.AdEvent.Type.PAUSED,this._adPausedListener);a.addEventListener(google.ima.AdEvent.Type.RESUMED,this._adResumedListener);a.addEventListener(google.ima.AdEvent.Type.CLICK,this._adClickedListener);a.addEventListener(google.ima.AdEvent.Type.COMPLETE,this._adCompletedListener)},_removeEventListeners:function(){var a=this._adsManager.getAdsManager();if(!a){return}a.removeEventListener(google.ima.AdEvent.Type.CONTENT_PAUSE_REQUESTED,this._contentPauseRequestedListener);a.removeEventListener(google.ima.AdEvent.Type.CONTENT_RESUME_REQUESTED,this._contentResumeRequestedListener);a.removeEventListener(google.ima.AdEvent.Type.LOADED,this._adLoadedListener);a.removeEventListener(google.ima.AdEvent.Type.AD_METADATA,this._adMetadataListener);a.removeEventListener(google.ima.AdEvent.Type.STARTED,this._adStartedListener);a.removeEventListener(google.ima.AdEvent.Type.SKIPPED,this._adSkippedListener);a.removeEventListener(google.ima.AdEvent.Type.PAUSED,this._adPausedListener);a.removeEventListener(google.ima.AdEvent.Type.RESUMED,this._adResumedListener);a.removeEventListener(google.ima.AdEvent.Type.CLICK,this._adClickedListener);a.removeEventListener(google.ima.AdEvent.Type.COMPLETE,this._adCompletedListener)},_adsReady:function(a){this.log("._adsReady");this._adsAreLinear=a?1:-1;this._notifyState()},_notifyState:function(){if(this._adsAreLinear!=0){if(this._state==null){this._state=this._stateFactory.createState((this._adsAreLinear>0),this._adStateContext,this,this._controller);if(this._state.getAdRule()){this._state.setCuePointTime(this._adRuleGovernor.getCuePointForLoadingState());try{var b=this._state.getCuePointTime()==0?"PRE ROLL":this._state.getCuePointTime()==$pdk.plugin.doubleclick.POST_ROLL_TIME?"POST ROLL":isNaN(this._state.getCuePointTime())?"NaN ROLL":"MID ROLL";this.log("\t"+b+" where cuePointTime is "+this._state.getCuePointTime())}catch(a){}if(!this._adRuleGovernor.isValidAdState(this._state)){this.log("AdRuleGovernor says not a valid state. Expect issues with ad playback!",tpConsts.WARN)}}this._doubleclick._updateAreas();this._doubleclick._doAdResize()}if(this._checkAd){this._state.checkAd()}if(this._playAds){this._state.playAds()}}},_onAdMetadata:function(a){this.log("._onAdMetadata")},_onAdLoaded:function(c){this.log("._onAdLoaded");this._saveAd(c.getAd());var a=this._adRuleGovernor.getCuePointForLoadingState();if(this._state&&this._state.getCuePointTime()!=a){this.log("\tlanded on a double loading situation. dispatching destroy all with data as true");this._doubleclick.reset(true)}var d="";if(c.getAd().isLinear()){this._linearAdsCounter++;var b=c.getAd().getAdPodInfo();this.log("linear: isBumper, adPosition, totalAds: "+b.getIsBumper()+", "+b.getAdPosition()+", "+b.getTotalAds());if(this._linearAdsCounter==1){this._adsReady(true)}}else{this.log("\t overlay");this._adsReady(false)}},_onAdStarted:function(a){this.log("._onAdStarted");if(this._state){this._state.adStartHandler(a)}},_onAdCompleted:function(a){this.log("._onAdCompleted");if(this._state){this._state.adCompletedHandler(a)}},_onAdClicked:function(a){this.log("._onAdClicked");if(this._state){this._state.adClickedHandler(a)}},_onAdPaused:function(a){this.log("._onAdPaused");if(this._state){this._state.adPausedHandler(a)}},_onAdResumed:function(a){this.log("._onAdResumed");if(this._state){this._state.adResumedHandler(a)}},_onAdSkipped:function(a){this.log("._onAdSkipped");if(this._state){this._state.adSkippedHandler(a)}},_onContentResumeRequested:function(a){this.log("onContentResumeRequested",tpConsts.INFO);if(this._state){this._state.handleContentResumeRequested(a)}},_onContentPauseRequested:function(a){this.log("onContentPauseRequested",tpConsts.INFO);if(this._adStateContext.getAds().length==0){this._sortAds()}if(this._state){this._state.handleContentPauseRequested(a)}},_saveAd:function(a){this._unsortedAds.push(a)},_sortAds:function(){if(this._unsortedAds.length==1){this._adStateContext.setAds(this._unsortedAds.concat())}else{var c;var f=[];for(var e=0;e<this._unsortedAds.length;e++){c=this._unsortedAds[e];if(f.length==0){f.push(c)}else{var b=f.length;for(var a=0;a<b;a++){var d=f[a];if(d.getAdPodInfo().getAdPosition()>c.getAdPodInfo().getAdPosition()){f.splice(a,0,c);break}else{if(a==b){f.push(c)}}}}}this._adStateContext.setAds(f.concat())}},dispose:function(){this.log(".dispose");if(this._state){this._state.dispose();this._state=null}this._adStateContext.setAds([]);if(this._adsManager){this._removeEventListeners();this._adsManager.reset()}this._adsManager=null;this._unsortedAds=null;this._stateFactory=null},stateFinished:function(){this.log(".stateFinished");this._playAds=false;this._checkAd=false;this._adsAreLinear=0;if(this._state){this._state.dispose()}this._state=null;this._unsortedAds=[];this._adStateContext.setAds([]);this._linearAdsCounter=0},checkAd:function(){this.log(".checkAd");this._checkAd=true;if(this._adsManager){this._notifyState()}},playAds:function(){this.log(".playAds");this._playAds=true;if(this._adsManager){this._notifyState()}},setAdsManager:function(a){this.log(".setAdsManager");this._adsManager=a;this._adStateContext.setAdsManager(a);this._addEventListeners();if(this._checkAd){this._notifyState()}},clearExistingState:function(){var b=".clearExistingState:";var a=false;if(this._playAds&&this._state&&!this._state.getLinear()){b+="clear an existing overlay";a=true}else{if(this._state&&this._adRuleGovernor.getCuePointForLoadingState()!=this._state.getCuePointTime()){b+="clearing an existing/preloading linear state";a=true}else{b+="nothing to clear"}}this.log(b);return a},getCurrentState:function(){return this._state},log:function(b,c){if(!c){c=tpConsts.DEBUG}var a=this._adStateContext&&this._adStateContext.getController()?this._adStateContext.getController().id:"";tpDebug(b,a,"Doubleclick",c)}});$pdk.plugin.doubleclick.StateFactory=$pdk.extend(function(){},{constructor:function(a){},createState:function(c,d,e,b){var f=null;if(!d||!d.getAdsManager()){return f}var a=(d.getAdsManager().getCuePoints()&&d.getAdsManager().getCuePoints().length>0);if(!c){this.log("\tOVERLAY STATE");f=new $pdk.plugin.doubleclick.OverlayState(d,e)}else{if(!a){this.log("\tTAGLINEAR STATE (same as LinearState)");f=new $pdk.plugin.doubleclick.LinearState(d,e,b)}else{this.log("\tLINEAR STATE");f=new $pdk.plugin.doubleclick.LinearState(d,e,b)}}f.setLinear(c);f.setAdRule(a);return f},log:function(a,b){if(!b){b=tpConsts.DEBUG}tpDebug(a,"","Doubleclick",b)}});$pdk.plugin.doubleclick.BaseState=$pdk.extend(function(){},{_playlist:null,_playAds:false,_checkAd:false,_adsManager:null,_adStateContext:null,_totalDuration:0,_adStates:null,_linear:0,_adRule:0,_cuePointTime:NaN,constructor:function(b,a){this.setAdStateContext(b);this._adStates=a},setupState:function(){},setAdsMananger:function(a){this._adsManager=a},getAdsMananger:function(){return this._adsManager},setTotalDuration:function(a){this._totalDuration=a},getTotalDuration:function(){return this._totalDuration},setAdStateContext:function(a){this._adStateContext=a;this._adsManager=a.getAdsManager();this.setupState()},getAdStateContext:function(){return this._adStateContext},setAdRule:function(a){this._adRule=a},getAdRule:function(){return this._adRule},setLinear:function(a){this._linear=a},getLinear:function(){return this._linear},setCuePointTime:function(a){this._cuePointTime=a},getCuePointTime:function(){return this._cuePointTime},playAds:function(){this._playAds=true;this.startAdPlayback()},getPlayAds:function(){return this._playAds},startAdPlayback:function(){},setAds:function(){if(!this._playlist){var a={baseClips:[],clips:[],globalDataType:"com.theplatform.pdk.data::Playlist"};this._adStateContext.getController().setAds(a);return}this._adStateContext.getController().setAds(this._playlist)},checkAd:function(){if(this._checkAd){return}this._checkAd=true;this._adsManager.pause(false);if(this._playlist){this.setAds()}},adClickedHandler:function(a){},adPausedHandler:function(a){},adResumedHandler:function(a){},adSkippedHandler:function(a){},adSkippableStateChangedHandler:function(a){},adStartHandler:function(a){},adCompletedHandler:function(a){},adExpandedChanged:function(a){},handleContentResumeRequested:function(a){},handleContentPauseRequested:function(a){},dispose:function(){this._adsManager=null;this._adStateContext=null;this._playlist=null;this._adStates=null},log:function(b,c){if(!c){c=tpConsts.DEBUG}var a=this._adStateContext&&this._adStateContext.getController()?this._adStateContext.getController().id:"";tpDebug(b,a,"Doubleclick",c)}});$pdk.plugin.doubleclick.LinearState=$pdk.extend($pdk.plugin.doubleclick.BaseState,{FORCE_END_DELAY:500,_adsCompleted:0,_noop:null,_onMediaLoadStart:false,_playbackPosition:0,_accumulatedPosition:0,_adPosition:0,_currentAd:null,_currentAdClip:null,_onMediaLoadStartListener:null,_onMediaEndTimeout:null,_leftFullScreenForDevices:false,_waitingToLeaveFullScreen:false,constructor:function(c,b,a){this._controller=a;$pdk.plugin.doubleclick.LinearState.superclass.constructor.call(this,c,b)},setupState:function(){this.log(".setupState");$pdk.plugin.doubleclick.LinearState.superclass.setupState.call(this)},setAds:function(){this.log(".setAds");var a=this;this._onMediaLoadStartListener=function(){a.playerOnMediaLoadStart.apply(a,arguments)};this.getAdStateContext().getController().addEventListener("OnMediaLoadStart",this._onMediaLoadStartListener);$pdk.plugin.doubleclick.LinearState.superclass.setAds.call(this)},startAdPlayback:function(){this.log(".startAdPlayback");if(this.getPlayAds()&&this._onMediaLoadStart){var a=this.getAdStateContext();a.getAdsManager().setVisible(true);if(!this._noop){this._noop=new $pdk.plugin.doubleclick.PdkNoopPlayer(a.getController(),a.getCurrentClip(),this._playerOnSetVolumeHandler,this._playerOnMuteHandler,this._pauseSetHandler,this._mediaPlayingCallback,this);var b=Math.round(a.getCurrentClip().mediaLength);var c={currentTime:0,duration:b};this._noop.playing(c);this._noop.start();this._checkForMediaEnd()}}},_onTimeUpdate:function(){if(Math.abs(this._proxy.currentTime-this._proxy.duration)<=0.0001){this.log("._onTimeUpdate: we're paused and pretty much at the end, but on some devices it won't end properly so do it manually",tpConsts.INFO);this._handleMediaEnd()}},_checkForMediaEnd:function(){if(tpIsAndroid()){this._proxy=this._controller.getVideoProxy();var a=this;this._timeUpdateInterval=setInterval(function(){a._onTimeUpdate.apply(a,arguments)},this.FORCE_END_DELAY)}},_handleMediaEnd:function(a){if(tpIsAndroid()){this.log("._handleMediaEnd: firing handleContentResumeRequested manually");clearInterval(this._timeUpdateInterval);this._adsCompleted++;this._adsManager.getAdsManager().stop();this.handleContentResumeRequested(null)}},playerOnMediaLoadStart:function(b){this.log(".playerOnMediaLoadStart");var a=b.data;if(a.streamType=="empty"){this._onMediaLoadStart=true;this._currentAdClip=a;this.startAdPlayback()}},createPlaylist:function(){this._playlist={baseClips:[],clips:[],globalDataType:"com.theplatform.pdk.data::Playlist"};var f=this._createClips(this.getAdStateContext().getAds());var e=f.clips;var i=f.baseClips;var g=e.length;for(var d=0;d<g;d++){var h=e.shift();var a=i.shift();this._playlist.clips.push(h);this._playlist.baseClips.push(a)}return this._playlist},_createClips:function(e){this.log(".createClips: ads.length: "+e.length);var a=[];var c=[];var j;var h;var f;for(var g=0;g<e.length;g++){j=e[g];var d=(j.isSkippable())?true:false;f=!d;h=this._createBaseClip(j,f);var b=com.theplatform.pdk.SelectorExported.getInstance(this.getAdStateContext().getController().scopes.toString()).parseClip(h);this._totalDuration+=j.getDuration()*1000;b.streamType="empty";b.length=j.getDuration()*1000;b.mediaLength=b.length;b.currentMediaTime=0;a.push(b);c.push(h)}this.getAdStateContext().getCurrentClip().mediaLength=this._totalDuration;this.getAdStateContext().getCurrentClip().currentMediaTime=0;return{clips:a,baseClips:c}},_createBaseClip:function(b,a){var c={};c.globalDataType="com.theplatform.pdk.data::BaseClip";c.overlays={};c.URL="";c.author="";c.title=b.title;c.isAd=true;c.noSkip=a;return c},_pauseSetHandler:function(a){this.log("._pauseSetHandler: "+a);this._adsManager.pause(a);this._noop.pause(a)},_playerOnMuteHandler:function(b){var a=(b)?0:1;this.log(".playerOnMuteHandler: "+a);this._adsManager.getAdsManager().setVolume(a)},_playerOnSetVolumeHandler:function(b){var a=parseInt(b)*0.01;this.log(".playerOnSetVolumeHandler: "+a);this._adsManager.getAdsManager().setVolume(a)},_mediaPlayingCallback:function(){var b="._mediaPlayingCallback: ";var a=this._adsManager.getAdsManager().getRemainingTime();if(this._currentAd){if(a<0){a=this._currentAd.getDuration()}this._playbackPosition=Math.max(0,(this._currentAd.getDuration()-a)*1000);if(this._noop){var c={currentTime:Math.round(this._playbackPosition),duration:Math.round(this._currentAd.getDuration()*1000)};b+=" currentTime:"+c.currentTime+"/duration:"+c.duration+" ";this._noop.playing(c);b+=", playbackPosition: "+this._playbackPosition+", accumulatedPosition: "+this._accumulatedPosition}}},adClickedHandler:function(a){this.log(".adClickedHander");this._noop.pause(true)},adPausedHandler:function(a){this.log(".adsPausedHandler");this._adsManager.pause(true)},adResumedHandler:function(a){this.log(".adsResumedHandler");this._adsManager.pause(false)},adStartHandler:function(a){this.log(".adStartHandler");this._currentAd=a.getAd();this._adPosition=this._currentAd.getAdPodInfo().getAdPosition()},adCompletedHandler:function(c){this.log(".adCompletedHandler");this._adsCompleted++;var a=c.getAd();var b=a.getDuration();this._accumulatedPosition+=b*1000},adExpandedChanged:function(a){},handleContentResumeRequested:function(b){this.log(".handleContentResumeRequested: resume content playback");clearTimeout(this._onMediaEndTimeout);this.getAdStateContext().getAdsManager().setVisible(false);var a=this;if(this._noop){var c={currentTime:this._playbackPosition,duration:this._currentAd.getDuration()*1000};this._noop.done(c,this.getAdStateContext().getCurrentClip())}if(this._adsCompleted>0){this.log("\tdone with this ad break. time to clean up.");this._adStates.stateFinished()}},handleContentPauseRequested:function(a){this.log(".handleContentPauseRequested");if(!this._playlist){this._playlist=this.createPlaylist();this.setAds()}},dispose:function(){this.log(".dispose");clearInterval(this._timeUpdateInterval);if(this._noop){this._noop.dispose()}this._noop=null;this.getAdStateContext().getController().removeEventListener("OnMediaLoadStart",this._onMediaLoadStartListener);this._onMediaLoadStartListener=null;$pdk.plugin.doubleclick.LinearState.superclass.dispose.call(this)},log:function(c,d){if(!d){d=tpConsts.DEBUG}var a=this.getAdStateContext()?this.getAdStateContext().getController():null;var b=a?a.id:"";tpDebug(c,b,"Doubleclick",d)}});$pdk.plugin.doubleclick.OverlayState=$pdk.extend($pdk.plugin.doubleclick.BaseState,{AD_CONTAINER_ID:"tpAdContainer",_onMediaLoadStart:false,_onMediaLoadStartListener:null,constructor:function(b,a){$pdk.plugin.doubleclick.OverlayState.superclass.constructor.call(this,b,a)},setAds:function(){var a=this;this._onMediaLoadStartListener=function(){a.playerOnMediaLoadStart.apply(a,arguments)};this.getAdStateContext().getController().addEventListener("OnMediaLoadStart",this._onMediaLoadStartListener);$pdk.plugin.doubleclick.OverlayState.superclass.setAds.call(this)},createPlaylist:function(){this.log(".createPlaylist: for overlays, creating legitimate clip which we will call endMedia on immediately.");var c={baseClips:[],clips:[],globalDataType:"com.theplatform.pdk.data::Playlist"};var b={};b.globalDataType="com.theplatform.pdk.data::BaseClip";b.URL="";b.author="";b.isAd=true;b.noSkip=true;var a=com.theplatform.pdk.SelectorExported.getInstance(this.getAdStateContext().getController().scopes.toString()).parseClip(b);a.streamType="empty";c.baseClips.push(b);c.clips.push(a);return c},startAdPlayback:function(){this.log(".startAdPlayback");if(this.getPlayAds()&&this._onMediaLoadStart){this.getAdStateContext().getAdsManager().setVisible(true);this.log("\tplayAds and onMediaLoadStart are true, so now end this 'clip' for overlay.");this.getAdStateContext().getController().endMedia(this._adStateContext.getCurrentClip())}},playerOnMediaLoadStart:function(b){this.log(".playerOnMediaLoadStart");var a=b.data;if(a.streamType=="empty"){this._onMediaLoadStart=true;this.startAdPlayback()}},adStartHandler:function(a){this.log(".adStartHandler");if(!this._playlist){this._adsManager.pause(true);this._playlist=this.createPlaylist();this.setAds()}},dispose:function(){this.getAdStateContext().getAdsManager().setVisible(false);this.getAdStateContext().getController().removeEventListener("OnMediaLoadStart",this._onMediaLoadStartListener);this._onMediaLoadStartListener=null;$pdk.plugin.doubleclick.OverlayState.superclass.dispose.call(this)},log:function(c,d){if(!d){d=tpConsts.DEBUG}var a=this.getAdStateContext()?this.getAdStateContext().getController():null;var b=a?a.id:"";tpDebug(c,b,"Doubleclick",d)}});(function(f){function e(){}for(var h="assert,count,debug,dir,dirxml,error,exception,group,groupCollapsed,groupEnd,info,log,markTimeline,profile,profileEnd,time,timeEnd,trace,warn".split(","),g;!!(g=h.pop());){f[g]=f[g]||e}})(function(){try{dcTrace();return window.console}catch(b){return(window.console={})}}());function dcTrace(d,e){var b={2:"DEBUG",8:"ERROR",1000:"FATAL",4:"INFO",2000:"NONE",1:"TEST",6:"WARN"},a="INFO";if(!e||e.length==0){e=4}if(b.hasOwnProperty(e)){a=b[e]}var c=a+" DoubleClick.js :: "+d;if(e==2){console.log(c)}else{if(e==4){console.info("%c"+c,"background: #FFFFCC; color: #336633")}else{if(e==6){console.warn(c)}else{if(e==8||e==1000){console.error(c)}}}}}var doubleclickPlugIn=new $pdk.plugin.doubleclick.Doubleclick();tpController.plugInLoaded(doubleclickPlugIn,null);

